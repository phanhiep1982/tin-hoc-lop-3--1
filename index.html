<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tin H·ªçc L·ªõp 3 - Gi·ªçng ƒê·ªçc Th√¥ng Minh</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&display=swap');
        body {
            font-family: 'Nunito', sans-serif;
            background-color: #f0f9ff;
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23bae6fd' fill-opacity='0.4'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            touch-action: manipulation;
        }
        .btn-3d {
            transition: all 0.1s;
            transform: translateY(0);
            box-shadow: 0 6px 0 rgb(0,0,0,0.2);
            position: relative;
        }
        .btn-3d:active {
            transform: translateY(4px);
            box-shadow: 0 2px 0 rgb(0,0,0,0.2);
        }
        .btn-3d:disabled {
            opacity: 0.6;
            filter: grayscale(100%);
        }
        .card-enter { animation: slideIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(50px) scale(0.9); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        .correct-anim { animation: bounce 0.5s; background-color: #86efac !important; border-color: #22c55e !important; color: #064e3b !important; }
        .wrong-anim { animation: shake 0.5s; background-color: #fca5a5 !important; border-color: #ef4444 !important; color: #7f1d1d !important;}
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-10px); } 75% { transform: translateX(10px); } }
        @keyframes bounce { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <div class="max-w-2xl w-full bg-white rounded-3xl shadow-2xl overflow-hidden border-4 border-blue-400 relative min-h-[600px] flex flex-col">
        
        <div class="bg-blue-500 p-4 text-white flex justify-between items-center shadow-md z-10">
            <div class="flex items-center gap-3">
                <div class="bg-white text-blue-500 rounded-full w-12 h-12 flex items-center justify-center font-bold shadow-sm text-2xl border-2 border-blue-200">
                    <i class="fas fa-gamepad"></i>
                </div>
                <div>
                    <h1 class="font-black text-xl leading-tight">Tin H·ªçc L·ªõp 3</h1>
                    <p class="text-xs text-blue-100 font-bold bg-blue-600 inline-block px-2 rounded-lg mt-1" id="mode-indicator">S·∫µn s√†ng</p>
                </div>
            </div>
            <div class="flex items-center gap-4">
                <div class="text-right bg-blue-600 px-3 py-1 rounded-xl border border-blue-300">
                    <p class="text-[10px] text-blue-100 uppercase font-bold">ƒêi·ªÉm s·ªë</p>
                    <p class="font-black text-2xl text-yellow-300 drop-shadow-sm" id="score">0</p>
                </div>
            </div>
        </div>

        <div class="w-full bg-gray-200 h-4 border-b-2 border-gray-300">
            <div id="progress-bar" class="bg-gradient-to-r from-yellow-400 to-orange-500 h-4 transition-all duration-500 shadow-inner" style="width: 0%"></div>
        </div>

        <div id="game-container" class="flex-1 p-6 flex flex-col justify-center items-center relative bg-blue-50">
            <div class="text-center">
                <div class="text-6xl text-blue-500 mb-6 animate-bounce"><i class="fas fa-play-circle"></i></div>
                <h2 class="text-2xl font-bold text-gray-700 mb-2">B√© ƒë√£ s·∫µn s√†ng ch∆∞a?</h2>
                <p class="text-gray-500 mb-8">Nh·∫•n n√∫t ƒë·ªÉ b·∫Øt ƒë·∫ßu v√† nghe gi·ªçng ƒë·ªçc nh√©!</p>
                <button id="start-btn" class="btn-3d bg-green-500 text-white font-black text-2xl py-4 px-12 rounded-full border-b-4 border-green-700 shadow-xl hover:bg-green-400">
                    B·∫ÆT ƒê·∫¶U NGAY
                </button>
            </div>
        </div>

        <div id="feedback-area" class="min-h-[100px] p-4 bg-white border-t-2 border-gray-100 flex justify-center items-center">
            <div class="flex items-center gap-4 text-gray-400">
                <i class="fas fa-volume-up"></i>
                <p class="text-sm italic font-bold">Game h·ªó tr·ª£ gi·ªçng ƒë·ªçc tr√™n c·∫£ iPhone/Android...</p>
            </div>
        </div>
    </div>

    <audio id="sound-correct" src="https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3" preload="auto"></audio>
    <audio id="sound-wrong" src="https://assets.mixkit.co/active_storage/sfx/2003/2003-preview.mp3" preload="auto"></audio>
    <audio id="sound-win" src="https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.mp3" preload="auto"></audio>

    <script>
        const rawQuestions = [
            { id: 1, type: 'quiz', question: "Lan nghe th·∫•y ti·∫øng k·∫ªng leng keng n√™n quy·∫øt ƒë·ªãnh v·ªÅ l·∫•y r√°c. 'Quy·∫øt ƒë·ªãnh' c·ªßa Lan l√† g√¨?", options: ["Ch·ªù m·ªôt l√°t nh√©", "C√≥ ti·∫øng g√µ k·∫ªng", "V·ªÅ l·∫•y t√∫i r√°c ra ƒë·ªÉ v·ª©t"], correct: 2, explain: "ƒê√∫ng r·ªìi! Ti·∫øng k·∫ªng l√† th√¥ng tin, h√†nh ƒë·ªông v·ªÅ l·∫•y r√°c l√† quy·∫øt ƒë·ªãnh." },
            { id: 2, type: 'quiz', question: "Nh√¨n th·∫•y ƒë√®n ƒë·ªè, Lan d·ª´ng l·∫°i. ƒê√¢u l√† c√¢u ƒë√∫ng?", options: ["ƒê√®n ƒë·ªè l√† Quy·∫øt ƒë·ªãnh", "ƒê√®n ƒë·ªè l√† Th√¥ng tin, D·ª´ng l·∫°i l√† Quy·∫øt ƒë·ªãnh", "C·∫£ hai ƒë·ªÅu l√† th√¥ng tin"], correct: 1, explain: "Ch√≠nh x√°c: M·∫Øt th·∫•y ƒë√®n ƒë·ªè (Th√¥ng tin) -> N√£o ra l·ªánh d·ª´ng (Quy·∫øt ƒë·ªãnh)." },
            { id: 3, type: 'match', question: "Ti·∫øng h√°t cho em th√¥ng tin d·∫°ng g√¨?", options: ["D·∫°ng h√¨nh ·∫£nh", "D·∫°ng ch·ªØ", "D·∫°ng √¢m thanh"], correct: 2, icon: "fa-music", explain: "Chu·∫©n lu√¥n! Ti·∫øng h√°t nghe b·∫±ng tai n√™n l√† d·∫°ng √¢m thanh." },
            { id: 4, type: 'quiz', question: "Qu√° tr√¨nh x·ª≠ l√Ω th√¥ng tin c·ªßa con ng∆∞·ªùi theo th·ª© t·ª± n√†o?", options: ["Thu nh·∫≠n -> X·ª≠ l√≠ -> Quy·∫øt ƒë·ªãnh", "X·ª≠ l√≠ -> Thu nh·∫≠n", "Quy·∫øt ƒë·ªãnh -> Thu nh·∫≠n"], correct: 0, explain: "ƒê√∫ng r·ªìi: Nh√¨n th·∫•y (Thu nh·∫≠n) -> Nghƒ© (X·ª≠ l√Ω) -> L√†m (Quy·∫øt ƒë·ªãnh)." },
            { id: 5, type: 'quiz', question: "Ch·∫°m tay v√†o ·∫•m n∆∞·ªõc n√≥ng, Minh r·ª•t tay l·∫°i. Th√¥ng tin Minh nh·∫≠n ƒë∆∞·ª£c l√† g√¨?", options: ["Minh r·ª•t tay l·∫°i", "·∫§m n∆∞·ªõc n√≥ng", "C·∫©n th·∫≠n nh√©"], correct: 1, explain: "Ch√≠nh x√°c. C√°i n√≥ng t·ª´ ·∫•m n∆∞·ªõc l√† th√¥ng tin truy·ªÅn ƒë·∫øn tay." },
            { id: 6, type: 'quiz', question: "S·∫Øp x·∫øp ƒë·ªì v·∫≠t h·ª£p l√≠ gi√∫p ch√∫ng ta ƒëi·ªÅu g√¨?", options: ["Qu·∫£n l√≠ d·ªÖ d√†ng h∆°n", "T√¨m ki·∫øm nhanh h∆°n", "C·∫£ hai √Ω tr√™n"], correct: 2, explain: "G·ªçn g√†ng gi√∫p v·ª´a d·ªÖ qu·∫£n l√Ω, v·ª´a t√¨m ƒë·ªì nhanh h∆°n." },
            { id: 9, type: 'match', question: "Hai ph√≠m n√†o tr√™n b√†n ph√≠m c√≥ g·ªù (gai) n·ªïi l√™n?", options: ["A v√† Z", "F v√† J", "G v√† H"], correct: 1, icon: "fa-keyboard", explain: "H√£y s·ªù th·ª≠ xem, ph√≠m F v√† J c√≥ g·ªù ƒë·ªÉ ƒë·∫∑t ng√≥n tr·ªè ƒë·∫•y." },
            { id: 10, type: 'quiz', question: "Ng·ªìi sai t∆∞ th·∫ø khi d√πng m√°y t√≠nh s·∫Ω b·ªã b·ªánh g√¨?", options: ["ƒêau tai", "ƒêau b·ª•ng", "Cong v·∫πo c·ªôt s·ªëng v√† c·∫≠n th·ªã"], correct: 2, explain: "Nh·ªõ ng·ªìi th·∫≥ng l∆∞ng v√† gi·ªØ kho·∫£ng c√°ch m·∫Øt nh√©." },
            { id: 11, type: 'quiz', question: "B·ªô ph·∫≠n n√†o gi√∫p nh·∫≠p ch·ªØ v√† s·ªë v√†o m√°y t√≠nh?", options: ["M√†n h√¨nh", "B√†n ph√≠m", "Th√¢n m√°y"], correct: 1, explain: "B√†n ph√≠m d√πng ƒë·ªÉ g√µ ch·ªØ, s·ªë v√† k√Ω hi·ªáu." },
            { id: 15, type: 'match', question: "B·ªô ph·∫≠n n√†o c·ªßa con ng∆∞·ªùi l√†m nhi·ªám v·ª• x·ª≠ l√≠ th√¥ng tin?", options: ["ƒê√¥i tay", "ƒê√¥i m·∫Øt", "B·ªô n√£o"], correct: 2, icon: "fa-brain", explain: "B·ªô n√£o gi·ªëng nh∆∞ CPU m√°y t√≠nh, gi√∫p suy nghƒ© v√† ra quy·∫øt ƒë·ªãnh." }
        ];

        let questions = [];
        let currentQIndex = 0;
        let score = 0;
        let wrongAnswers = [];
        let isReviewMode = false;
        
        const gameContainer = document.getElementById('game-container');
        const feedbackArea = document.getElementById('feedback-area');
        const scoreEl = document.getElementById('score');
        const progressBar = document.getElementById('progress-bar');
        const modeIndicator = document.getElementById('mode-indicator');

        // H√ÄM ƒê·ªåC M·ªöI: T∆∞∆°ng th√≠ch ho√†n to√†n v·ªõi iPhone/iPad
        function speak(text) {
            if (!window.speechSynthesis) return;
            
            // H·ªßy c√°c y√™u c·∫ßu ƒë·ªçc c≈© ƒë·ªÉ tr√°nh b·ªã ch·ªìng ch√©o
            window.speechSynthesis.cancel();

            const msg = new SpeechSynthesisUtterance();
            msg.text = text;
            msg.lang = 'vi-VN';
            msg.rate = 1.0; 
            msg.pitch = 1.0;

            // T√¨m gi·ªçng Vi·ªát Nam ch·∫•t l∆∞·ª£ng cao tr√™n thi·∫øt b·ªã
            const voices = window.speechSynthesis.getVoices();
            const viVoice = voices.find(v => v.lang.includes('vi') || v.lang.includes('VN'));
            if (viVoice) msg.voice = viVoice;

            window.speechSynthesis.speak(msg);
        }

        // K√≠ch ho·∫°t √¢m thanh l·∫ßn ƒë·∫ßu (C·∫ßn thi·∫øt cho iOS)
        document.getElementById('start-btn').addEventListener('click', function() {
            // "M·ªü kh√≥a" h·ªá th·ªëng √¢m thanh
            speak(""); 
            document.getElementById('sound-correct').play();
            document.getElementById('sound-correct').pause();
            
            startGame();
        });

        function startGame() {
            questions = rawQuestions.sort(() => Math.random() - 0.5);
            currentQIndex = 0;
            score = 0;
            wrongAnswers = [];
            isReviewMode = false;
            scoreEl.textContent = "0";
            modeIndicator.textContent = "V√≤ng Th·ª≠ Th√°ch";
            renderQuestion();
            speak("Ch√†o m·ª´ng b√© ƒë·∫øn v·ªõi b√†i √¥n t·∫≠p tin h·ªçc.");
        }

        function renderQuestion() {
            const q = questions[currentQIndex];
            progressBar.style.width = `${(currentQIndex / questions.length) * 100}%`;
            gameContainer.innerHTML = '';
            
            const card = document.createElement('div');
            card.className = "w-full text-center card-enter";
            
            if (q.type === 'match' && q.icon) {
                card.innerHTML += `<div class="text-5xl text-blue-500 mb-4"><i class="fas ${q.icon}"></i></div>`;
            }

            card.innerHTML += `<h2 class="text-xl md:text-2xl font-bold text-gray-800 mb-6 bg-white p-4 rounded-xl border-2 border-blue-100 shadow-sm">${q.question}</h2>`;
            
            const grid = document.createElement('div');
            grid.className = "grid grid-cols-1 gap-3";

            q.options.forEach((opt, idx) => {
                const btn = document.createElement('button');
                btn.className = "btn-3d w-full bg-white border-2 border-blue-200 text-blue-700 font-bold py-4 px-4 rounded-xl text-lg flex items-center gap-3";
                btn.innerHTML = `<span class="bg-blue-100 text-blue-600 w-8 h-8 rounded-full flex items-center justify-center text-sm font-black">${String.fromCharCode(65 + idx)}</span> <span class="text-left flex-1">${opt}</span>`;
                btn.onclick = () => checkAnswer(idx, q.correct, btn, q);
                grid.appendChild(btn);
            });
            
            card.appendChild(grid);
            gameContainer.appendChild(card);
            setTimeout(() => speak(q.question), 400);
        }

        function checkAnswer(userAns, correctAns, btnElement, qObj) {
            const allBtns = document.querySelectorAll('#game-container button');
            allBtns.forEach(b => b.disabled = true);

            if (userAns === correctAns) {
                btnElement.classList.add('correct-anim');
                document.getElementById('sound-correct').play();
                score += 10;
                scoreEl.textContent = score;
                feedbackArea.innerHTML = `<p class="text-green-600 font-bold text-lg">ƒê√∫ng r·ªìi! üåü</p>`;
                speak("ƒê√∫ng r·ªìi. " + qObj.explain);
                confetti({ particleCount: 40, spread: 50 });
            } else {
                btnElement.classList.add('wrong-anim');
                allBtns[correctAns].classList.add('correct-anim');
                document.getElementById('sound-wrong').play();
                if (!isReviewMode) wrongAnswers.push(qObj);
                feedbackArea.innerHTML = `<p class="text-red-500 font-bold text-lg">C·ªë g·∫Øng l√™n nh√©! ‚ù§Ô∏è</p>`;
                speak("Ch∆∞a ƒë√∫ng r·ªìi. " + qObj.explain);
            }
            setTimeout(nextQuestion, 4500);
        }

        function nextQuestion() {
            currentQIndex++;
            if (currentQIndex < questions.length) {
                renderQuestion();
            } else {
                finishRound();
            }
        }

        function finishRound() {
            gameContainer.innerHTML = '';
            if (!isReviewMode && wrongAnswers.length > 0) {
                isReviewMode = true;
                questions = [...wrongAnswers];
                currentQIndex = 0;
                modeIndicator.textContent = "V√≤ng √în T·∫≠p";
                gameContainer.innerHTML = `<div class="text-center">
                    <h2 class="text-2xl font-bold mb-4">C√πng √¥n l·∫°i c√¢u sai nh√©!</h2>
                    <button onclick="renderQuestion()" class="btn-3d bg-orange-500 text-white font-bold py-3 px-8 rounded-full">B·∫ÆT ƒê·∫¶U √îN</button>
                </div>`;
                speak("Ch√∫ng ta c√πng xem l·∫°i nh·ªØng c√¢u ch∆∞a ƒë√∫ng nh√©.");
            } else {
                document.getElementById('sound-win').play();
                gameContainer.innerHTML = `<div class="text-center">
                    <div class="text-6xl text-yellow-400 mb-4"><i class="fas fa-trophy"></i></div>
                    <h2 class="text-3xl font-black text-blue-600">HO√ÄN TH√ÄNH!</h2>
                    <p class="text-xl font-bold mt-2">ƒêi·ªÉm c·ªßa b√©: ${score}</p>
                    <button onclick="location.reload()" class="mt-6 btn-3d bg-green-500 text-white font-bold py-3 px-8 rounded-full">CH∆†I L·∫†I</button>
                </div>`;
                speak("Ch√∫c m·ª´ng b√© ƒë√£ ho√†n th√†nh xu·∫•t s·∫Øc b√†i t·∫≠p!");
            }
        }
    </script>
</body>
</html>
